<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sahil Puri | Home </title>
<link rel="stylesheet" href="style.css"/>
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.161.0/build/three.module.js"
  }
}
</script>

<style>
  :root{
    --porcelain:   #f7f7f2;
    --beige:       #e4e6c3;
    --palm-leaf:   #899878;
    --carbon-black:#222725;
    --onyx:        #121113;
  }
html,body{
    height:100%;
    margin:0;
    background:#f7f7f2;
    color:#000000;
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    perspective:1000px; /* helps 3D tilt feel better */
  }

  .nav{
    position:fixed;
    top:0;left:0;right:0;
    z-index:10;
    background:rgba(255,255,255,0.9);
    backdrop-filter:blur(10px);
    border-bottom:1px solid #e0e0e0;
  }
  .nav-inner{
    max-width:1100px;
    margin:0 auto;
    padding:12px 16px;
    display:flex;
    gap:16px;
    align-items:center;
  }
  .brand{
    font-weight:700;
    color:var(--carbon-black);
    text-decoration:none;
  }
  .tabs{
    margin-left:auto;
    display:flex;
    gap:10px;
  }
  .tab{
    color:#333333;
    text-decoration:none;
    padding:6px 10px;
    border-radius:8px;
    border:1px solid transparent;
  }
  .tab:hover{
    background:var(--porcelain);
    border-color:var(--beige);
  }

  /* Left bio panel */
  .bio-panel{
    position:fixed;
    top:80px;
    left:56px;
    bottom:80px;

    width:min(420px, 32vw);
    max-height:calc(100vh - 80px - 40px);

    background:rgba(255,255,255,0.88);
    backdrop-filter:blur(16px);

    border-radius:22px;
    border:1px solid rgba(137,152,120,0.4);
    box-shadow:
      0 26px 60px rgba(0,0,0,0.24),
      0 0 0 1px rgba(255,255,255,0.6);

    z-index:3;
    display:flex;
    flex-direction:column;
    overflow:hidden;

    transform-origin:left center;
    transform:translateZ(0) rotateY(5deg); /* left edge closer */
    transition:
      transform 0.15s ease-out,
      box-shadow 0.15s ease-out,
      background 0.15s ease-out;
  }

  .bio-photo{
    padding:18px 0 10px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-bottom:1px solid rgba(137,152,120,0.35);
  }
.bio-photo-inner{
  width:140px;
  height:140px;
  border-radius:50%;
  background: linear-gradient(135deg, rgba(137,152,120,0.8), rgba(228,230,195,0.7));
  box-shadow:0 10px 25px rgba(0,0,0,0.18);
  position:relative;
  overflow:hidden;
}
  .bio-photo-inner img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .bio-content{
    padding:16px 18px 18px;
    overflow-y:auto;
  }
  .bio-content h2{
    margin:0 0 4px;
    font-size:18px;
    font-weight:700;
    color:var(--carbon-black);
  }
  .bio-content h3{
    margin:0 0 14px;
    font-size:13px;
    font-weight:600;
    letter-spacing:0.08em;
    text-transform:uppercase;
    color:var(--palm-leaf);
  }
  .bio-content p{
    margin:0 0 14px;
    font-size:14px;
    line-height:1.6;
    color:#333333;
  }
  .bio-links{
    display:flex;
    gap:10px;
    margin:4px 0 16px;
  }
  .icon-link{
    width:34px;
    height:34px;
    border-radius:10px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    background:rgba(137,152,120,0.12);
    border:1px solid rgba(137,152,120,0.25);
    color:var(--carbon-black);
    text-decoration:none;
    transition:transform 0.12s ease, background 0.12s ease, border-color 0.12s ease;
  }
  .icon-link svg{
    width:18px;
    height:18px;
    stroke:currentColor;
  }
  .icon-link:hover{
    background:var(--porcelain);
    border-color:var(--beige);
    transform:translateY(-1px);
  }
  .icon-link:focus-visible{
    outline:none;
    box-shadow:0 0 0 3px rgba(137,152,120,0.35);
  }

  /* Right project panel – same language as bio, mirrored */
  .project-panel{
    position:fixed;
    top:80px;
    right:56px;
    bottom:80px;

    width:min(420px, 32vw);
    max-height:calc(100vh - 80px - 40px);

    background:rgba(255,255,255,0.88);
    backdrop-filter:blur(16px);

    border-radius:22px;
    border:1px solid rgba(137,152,120,0.4);
    box-shadow:
      0 26px 60px rgba(0,0,0,0.24),
      0 0 0 1px rgba(255,255,255,0.6);

    z-index:3;
    display:flex;
    flex-direction:column;
    overflow:hidden;

    transform-origin:right center;
    transform:translateZ(0) rotateY(-5deg); /* right edge closer to screen plane, left slightly back */
    transition:
      transform 0.15s ease-out,
      box-shadow 0.15s ease-out,
      background 0.15s ease-out;
  }

  .project-photo{
    height:220px;
    background:
      linear-gradient(
        135deg,
        rgba(137,152,120,0.7),
        rgba(228,230,195,0.5)
      );
    position:relative;
    overflow:hidden;
    border-top-left-radius: inherit;
    border-top-right-radius: inherit;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  .project-photo img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .project-photo::after{
    display: none;
  }

  .project-content{
    padding:8px 18px 12px;
    flex:1;
    overflow-y:auto;
  }
  .project-title{
    margin:0;
    padding:12px 18px 0;
    font-size:16px;
    font-weight:600;
    color:var(--carbon-black);
  }
  .project-title a{
    color:inherit;
    text-decoration:none;
  }
  .project-title a:hover{
    text-decoration:underline;
  }
  .project-text{
    margin:0;
    font-size:14px;
    line-height:1.6;
    color:#333333;
  }
  .project-body{
    margin:10px 0 0;
    padding-left:18px;
    color:#333333;
    font-size:13px;
    line-height:1.55;
  }
  .project-body li{
    margin:0 0 6px;
  }
  .project-cta{
    display:inline-block;
    margin-top:12px;
    color:var(--palm-leaf);
    text-decoration:none;
    font-weight:600;
  }
  .project-cta:hover{
    text-decoration:underline;
  }

  .project-dots{
    padding:10px 16px 16px;
    display:flex;
    justify-content:center;
    gap:8px;
  }
  .project-dot{
    width:10px;
    height:10px;
    border-radius:50%;
    border:1px solid rgba(137,152,120,0.6);
    background:transparent;
    padding:0;
    cursor:pointer;
    transition:background 0.15s ease, transform 0.15s ease, border-color 0.15s ease;
  }
  .project-dot.active{
    background:var(--palm-leaf);
    border-color:var(--palm-leaf);
    transform:scale(1.1);
  }

  /* 3D stage behind floating panels */
  #stage{
    position:absolute;
    top:56px;   /* below navbar */
    left:0;
    right:0;
    bottom:0;
    z-index:1;
  }

  .hint{
    position:fixed;
    left:24px;
    bottom:12px;
    color:#555555;
    font-size:12px;
    pointer-events:none;
    z-index:2;
  }
  .badge{
    position:fixed;
    right:12px;
    bottom:12px;
    background:rgba(255,255,255,0.9);
    border:1px solid #e0e0e0;
    color:#333333;
    padding:6px 10px;
    border-radius:8px;
    font-size:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    z-index:2;
  }

/* ========================================================================== */
/*  Compact floating control bar INSIDE the stage                             */
/* ========================================================================== */

.viewer-controls {
  position: absolute;
  left: 50% !important;
  bottom: 16px !important;
  top: auto !important;
  right: auto !important;
  transform: translateX(-50%);
  z-index: 6;
  transform-origin: bottom center;

  width: auto;
  min-width: 260px;
  max-width: 380px;
  max-height: 180px;
  overflow: auto;

  /* light glass panel background */
  background: rgba(247,247,242,0.95);
  backdrop-filter: blur(10px);

  border-radius: 16px;
  border: 1px solid var(--beige);
  box-shadow: 0 16px 40px rgba(0,0,0,0.18);

  padding: 6px 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  pointer-events: auto;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--carbon-black);
}

/* ========================================================================== */
/*  lil-gui LIGHT THEME + VIEWER CONTROL STYLING                              */
/* ========================================================================== */

/* Main panel: force lil-gui to be light */
.viewer-controls.lil-gui,
.viewer-controls.lil-gui.root {
  background: rgba(247,247,242,0.95) !important;
  color: var(--carbon-black) !important;
  border: 1px solid var(--beige) !important;
  box-shadow: 0 16px 40px rgba(0,0,0,0.18) !important;
  margin: 0 !important;
  height: auto !important;
}

/* Kill lil-gui's inset dark layer */
.viewer-controls.lil-gui::before {
  background: transparent !important;
}

/* Internal rows / labels inherit light look */
.viewer-controls.lil-gui .children,
.viewer-controls.lil-gui .folder,
.viewer-controls.lil-gui .controller,
.viewer-controls.lil-gui .widget,
.viewer-controls.lil-gui .name,
.viewer-controls.lil-gui .display,
.viewer-controls.lil-gui .values {
  background: transparent !important;
  color: inherit !important;
  border-color: rgba(137,152,120,0.4) !important;
}

/* Title bar: white pill, green text, slightly bigger & vertically centered */
.viewer-controls .title {
  background: transparent !important;
  color: var(--carbon-black) !important;
  padding: 0 !important;
  font-weight: 700;
  font-size: 14px;
  letter-spacing: 0.12em;
  margin: 8px 0 6px;
  text-align: center;
  text-transform: uppercase;
  line-height: 1.1;
  align-self: center;
}

/* Layout for rows */
.viewer-controls .children {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.viewer-controls .controller {
  padding: 4px 8px;
  background: transparent !important;
  border: 1px solid var(--carbon-black) !important;
  border-radius: 8px;
  color: var(--carbon-black) !important;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
}

/* Label text */
.viewer-controls .controller .name {
  color: #555;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

/* ========================================================================== */
/*  Inputs & dropdowns                                                        */
/* ========================================================================== */

.viewer-controls input,
.viewer-controls select {
  width: 100%;
  max-width: 100%;
  border-radius: 999px;
  border: 1px solid rgba(137,152,120,0.4);
  background: #ffffff;
  color: var(--carbon-black);
  padding: 3px 8px;
  font-size: 12px;
  outline: none;
  box-shadow: none;
}

/* DISTINCT BUTTON STYLE FOR MODE + TONEMAPPING SELECTS */
.viewer-controls.lil-gui select {
  -webkit-appearance: none;
  appearance: none;

  background: var(--palm-leaf) !important;
  color: var(--carbon-black) !important;
  -webkit-text-fill-color: var(--carbon-black) !important;

  border: 2px solid var(--carbon-black) !important;
  border-radius: 12px !important;

  padding: 6px 28px 6px 10px !important;   /* leave room for arrow */
  font-weight: 700 !important;
  font-size: 12px !important;
  cursor: pointer;
}

.viewer-controls.lil-gui select option {
  color: var(--carbon-black);
  background: #ffffff;
}

/* Replace lil-gui’s default widget box */
.viewer-controls.lil-gui .widget {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

/* Custom arrow icon in the select */
.viewer-controls.lil-gui select {
  background-image: url("data:image/svg+xml;utf8,<svg fill='%23899878' height='12' viewBox='0 0 24 24' width='12' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-size: 12px;
  background-position: right 8px center;
}

/* Hover / focus for selects */
.viewer-controls.lil-gui select:hover,
.viewer-controls.lil-gui select:focus {
  background: var(--carbon-black) !important;
  color: #ffffff !important;
  border-color: var(--palm-leaf) !important;
}

/* Numeric value boxes next to sliders */
.viewer-controls.lil-gui .display input {
  background: #ffffff !important;
  color: var(--palm-leaf) !important;
  caret-color: var(--palm-leaf) !important;
  border: 1px solid rgba(137,152,120,0.35) !important;
  border-radius: 8px !important;
}
.viewer-controls.lil-gui .display {
  color: var(--palm-leaf) !important;
}

/* ========================================================================== */
/*  Minimal sliders — line + circular thumb                                   */
/* ========================================================================== */

.viewer-controls.lil-gui input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 20px;
  background: transparent;
  border: none;
  margin: 0;
  padding: 0;
}

.viewer-controls.lil-gui input[type="range"]::-webkit-slider-runnable-track {
  height: 2px;
  border-radius: 2px;
  background: rgba(137,152,120,0.45);
}

.viewer-controls.lil-gui input[type="range"]::-moz-range-track {
  height: 2px;
  border-radius: 2px;
  background: rgba(137,152,120,0.45);
}

.viewer-controls.lil-gui input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--palm-leaf) !important;
  border: 1px solid var(--carbon-black) !important;
  margin-top: -6px;
  cursor: pointer;
}

.viewer-controls.lil-gui input[type="range"]::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--palm-leaf) !important;
  border: 1px solid var(--carbon-black) !important;
  cursor: pointer;
}

.viewer-controls.lil-gui .slider {
  position: relative;
  height: 20px;
  margin-top: 4px;
  background: transparent !important;
  border: none !important;
  border-radius: 0;
  cursor: pointer;
}

.viewer-controls.lil-gui .slider::before {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  height: 2px;
  border-radius: 2px;
  background: rgba(137,152,120,0.45);
  pointer-events: none;
}

.viewer-controls.lil-gui .slider .slider-fg {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  height: 2px;
  border-radius: 2px;
  background: var(--palm-leaf) !important;
  pointer-events: none;
}

.viewer-controls.lil-gui .slider-thumb,
.viewer-controls.lil-gui .slider .slider-fg .slider-thumb {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--palm-leaf) !important;
  background-image: none !important;
  border: 1px solid var(--carbon-black) !important;
  box-shadow: 0 1px 3px rgba(0,0,0,0.18);
  transform: translate(50%, -50%);
}

.viewer-controls.lil-gui .slider .slider-fg::after {
  content: "";
  position: absolute;
  right: 0;
  top: 50%;
  transform: translate(50%, -50%);
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--palm-leaf) !important;
  border: 1px solid var(--carbon-black) !important;
  box-shadow: 0 1px 3px rgba(0,0,0,0.18);
  pointer-events: none;
}

/* ========================================================================== */
/*  Buttons (e.g. ResetCamera)                                                */
/* ========================================================================== */

.viewer-controls button {
  width: 100%;
  border-radius: 10px !important;
  border: 2px solid var(--palm-leaf) !important;
  background: var(--porcelain) !important;
  color: var(--carbon-black) !important;
  font-size: 11px;
  font-weight: 600 !important;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 4px 10px;
  cursor: pointer;
}

.viewer-controls button:hover {
  background: var(--beige) !important;
}

/* Hide lil-gui's tiny close/reset buttons if they appear */
.viewer-controls .close-button,
.viewer-controls .reset {
  display: none !important;
}

/* ======================= TABLET ======================= */
@media (max-width: 1024px) {
  .nav-inner {
    max-width: 100%;
    padding: 10px 12px;
  }

  .bio-panel,
  .project-panel {
    top: 76px;
    bottom: 40px;
    width: min(320px, 32vw);
  }

  .hint,
  .badge {
    font-size: 11px;
    bottom: 8px;
  }

  .viewer-controls {
    bottom: 8px !important;
    max-width: 340px;
  }
}

/* ======================= NARROW DESKTOP (pre-mobile) ======================= */
@media (max-width: 900px) and (min-width: 769px) {
  .bio-panel,
  .project-panel {
    width: min(280px, 30vw);
  }
}

/* ======================= MOBILE ======================= */
@media (max-width: 768px) {
  body {
    display: flex;
    flex-direction: column;
    align-items: stretch;
    padding-top: 56px;
  }

  .nav {
    order: 0;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .nav-inner {
    padding: 8px 10px;
    gap: 8px;
  }

  .tabs {
    gap: 6px;
  }

  .tab {
    padding: 4px 8px;
    font-size: 12px;
  }

  /* Panels become normal stacked blocks */
  .bio-panel,
  .project-panel {
    order: 2;
    position: static;
    width: auto;
    max-width: none;
    max-height: none;
    margin: 16px 12px 10px;
    transform: none;
    box-shadow: 0 10px 24px rgba(0,0,0,0.12);
    overflow: visible;
    background: rgba(255,255,255,0.9);
  }

  .project-panel {
    margin-top: 10px;
    order: 3;
  }

  .bio-content,
  .project-content {
    overflow: visible;
    max-height: none;
  }

  #stage {
    order: 1;
    position: relative;
    top: 0;
    bottom: auto;
    height: min(60vh, 420px);
    margin: 8px 12px 16px;
    padding-bottom: 96px;
  }

  .viewer-controls {
    position: absolute !important;
    top: auto !important;
    bottom: 12px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: calc(100% - 48px);
    max-width: 520px;
    margin: 0;
  }

  .hint,
  .badge {
    display: none;
  }
}

/* ======================= SMALL MOBILE ======================= */
@media (max-width: 480px) {
  .bio-panel,
  .project-panel {
    margin: 8px 8px 8px;
    border-radius: 16px;
    background: rgba(255,255,255,0.9);
  }

  #stage {
    margin: 8px 8px 16px;
    height: min(55vh, 360px);
    padding-bottom: 88px;
  }

  .viewer-controls {
    padding: 4px 8px;
    border-radius: 14px;
    width: calc(100% - 32px);
  }
}






</style>

</head>
<body>
  <div id="site-nav"></div>

  <!-- Left bio panel -->
  <div class="bio-panel">
    <div class="bio-photo">
      <div class="bio-photo-inner">
        <img src="assets/profile_pic.jpg" alt="Profile Pic">
      </div>
    </div>
    <div class="bio-content">
      <h2>Sahil Puri</h2>
      <h3>Graphics &amp; Gameplay Engineer</h3>
      <div class="bio-links">
        <a class="icon-link" href="mailto:sahilpuri.5@gmail.com" aria-label="Email Sahil">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" role="img" aria-hidden="true">
            <path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
            <path d="m22 6-10 7L2 6"/>
          </svg>
        </a>
        <a class="icon-link" href="https://github.com/sahilpuri22" target="_blank" rel="noopener" aria-label="Sahil on GitHub">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" role="img" aria-hidden="true">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
          </svg>
        </a>
        <a class="icon-link" href="https://www.linkedin.com/in/sahil-puri-90b13b228/" target="_blank" rel="noopener" aria-label="Sahil on LinkedIn">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" role="img" aria-hidden="true">
            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
            <rect x="2" y="9" width="4" height="12"/>
            <circle cx="4" cy="4" r="2"/>
          </svg>
        </a>
        <a class="icon-link" href="assets/sahil_puri_cv.pdf" target="_blank" rel="noopener" aria-label="Open CV PDF">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" role="img" aria-hidden="true">
            <path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"/>
            <path d="M14 2v6h6"/>
            <path d="M8 14h8"/>
            <path d="M8 18h5"/>
          </svg>
        </a>
      </div>

      <p>
        I currently work as a Technical Solutions & Partnerships Lead at <a href="https://www.fugumobile.com/" target="_blank" rel="noopener">Fugumobile</a>, representing the company across the UK and Europe. I’ve recently graduated from the University of Leeds where I studied Computer Science with High-Performance Graphics and Games Engineering (BSc, Meng).
        While my main interests are in graphics programming, game development, and software engineering, I place strong value on staying open-minded and curious, and I enjoy exploring new domains and technical challenges.
      </p>
    </div>
  </div>

  <!-- Right project panel (carousel) -->
  <div class="project-panel">
    <div class="project-photo">
      <!-- Optional: <img> will go here -->
    </div>
    <h3 class="project-title"><a href="#" class="project-title-link"></a></h3>
    <div class="project-content">
      <p class="project-text"></p>
      <ul class="project-body"></ul>
      <a class="project-cta" href="#">View project →</a>
    </div>
    <div class="project-dots"></div>
  </div>

  <div id="stage">
    <div class="viewer-attribution">
      Model:
      <a href="https://graphics.stanford.edu/data/3Dscanrep/"
        target="_blank" rel="noopener">
        Stanford Bunny
      </a>
      — Stanford 3D Scanning Repository
    </div>
  </div>



  <!-- Three.js & helpers (CDN) -->
  <script type="module">
    import * as THREE from "three";
    import {OrbitControls} from "https://unpkg.com/three@0.161.0/examples/jsm/controls/OrbitControls.js";
    import {OBJLoader} from "https://unpkg.com/three@0.161.0/examples/jsm/loaders/OBJLoader.js";
    import {MTLLoader} from "https://unpkg.com/three@0.161.0/examples/jsm/loaders/MTLLoader.js";
    import {RGBELoader} from "https://unpkg.com/three@0.161.0/examples/jsm/loaders/RGBELoader.js";
    import {GUI} from "https://unpkg.com/lil-gui@0.19/dist/lil-gui.esm.js";

    // ---------- Basic scene ----------
    const container = document.getElementById("stage");
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.25;
    container.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color("#f7f7f2");

    const camera = new THREE.PerspectiveCamera(45, container.clientWidth/container.clientHeight, 0.05, 200);
    camera.position.set(2.5, 1.6, 3.0);

    function resizeRenderer(){
      const width = container.clientWidth || window.innerWidth;
      const height = container.clientHeight || Math.min(window.innerHeight * 0.6, 420);
      renderer.setSize(width, height);
      camera.aspect = width / Math.max(height, 1);
      camera.updateProjectionMatrix();
    }
    resizeRenderer();

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.06;
    controls.enablePan = false;
    controls.enableZoom = false;

    // ---------- Lights ----------
    const key = new THREE.DirectionalLight(0xffffff, 3.0);
    key.position.set(5, 6, 4);

    const fill = new THREE.HemisphereLight(0xffffff, 0x666666, 1.2);

    const rim = new THREE.DirectionalLight(0xffffff, 1.5);
    rim.position.set(-4, 3, -6);

    scene.add(key, fill, rim);

    // ---------- Environment (optional HDR) ----------
    let envMap = null;
    try {
      new RGBELoader()
        .setPath("assets/")
        .load("studio.hdr", (hdr)=>{
          hdr.mapping = THREE.EquirectangularReflectionMapping;
          envMap = hdr;
          scene.environment = envMap;
          renderer.render(scene, camera);
        });
    } catch(e){ /* no HDR, fine */ }

    // ---------- Materials / Modes ----------
    const texLoader = new THREE.TextureLoader();
    function makeChecker(size=512, squares=8){
      const c = document.createElement('canvas');
      c.width = c.height = size;
      const g = c.getContext('2d');
      const s = size/squares;
      for(let y=0;y<squares;y++){
        for(let x=0;x<squares;x++){
          g.fillStyle = (x+y)%2 ? "#9a8c98" : "#f2e9e4";
          g.fillRect(x*s,y*s,s,s);
        }
      }
      const t = new THREE.CanvasTexture(c);
      t.colorSpace = THREE.SRGBColorSpace;
      t.wrapS = t.wrapT = THREE.RepeatWrapping;
      t.repeat.set(1,1);
      return t;
    }
    const uvChecker = makeChecker();

    const normalVisMat = new THREE.ShaderMaterial({
      vertexShader: /* glsl */`
        varying vec3 vNormalWS;
        void main(){
          vNormalWS = normalize(normalMatrix * normal);
          vec4 mv = modelViewMatrix * vec4(position,1.0);
          gl_Position = projectionMatrix * mv;
        }`,
      fragmentShader: /* glsl */`
        varying vec3 vNormalWS;
        void main(){
          vec3 n = normalize(vNormalWS) * 0.5 + 0.5;
          gl_FragColor = vec4(n,1.0);
        }`
    });

    const materials = {
      PBR: new THREE.MeshStandardMaterial({color:"#899878", metalness:0.25, roughness:0.45, envMapIntensity:1.35}),
      "Surface Normals": normalVisMat,
      "UV Checker": new THREE.MeshBasicMaterial({map: uvChecker}),
      Topology: new THREE.MeshBasicMaterial({color:"#222725", wireframe:true, transparent:true, opacity:0.35})
    };

    // ---------- Load model (fallback if missing) ----------
    let modelRoot = new THREE.Group();
    scene.add(modelRoot);

    async function loadModel() {
      const objLoader = new OBJLoader().setPath("assets/");
      try{
        try {
          const mtl = await new MTLLoader().setPath("assets/").loadAsync("model.mtl");
          mtl.preload();
          objLoader.setMaterials(mtl);
        } catch {/* no MTL */}

        const obj = await objLoader.loadAsync("model.obj");
        const box = new THREE.Box3().setFromObject(obj);
        const center = new THREE.Vector3(); box.getCenter(center);
        obj.position.sub(center);
        obj.updateMatrixWorld(true);
        modelRoot.add(obj);
        fitCameraToObject(modelRoot);
      } catch (e){
        const geo = new THREE.TorusKnotGeometry(0.6, 0.22, 256, 32);
        const mesh = new THREE.Mesh(geo, materials.PBR);
        modelRoot.add(mesh);
        fitCameraToObject(modelRoot);
      }
      applyMaterial(currentMode);
    }

    function fitCameraToObject(obj){
      const box = new THREE.Box3().setFromObject(obj);
      const size = new THREE.Vector3(); box.getSize(size);
      const center = new THREE.Vector3(); box.getCenter(center);
      const maxDim = Math.max(size.x, size.y, size.z);
      const dist = maxDim / (2 * Math.tan(THREE.MathUtils.degToRad(camera.fov/2)));
      camera.position.copy(center).add(new THREE.Vector3(dist*1.6, dist*1.0, dist*1.6));
      camera.near = Math.max(0.01, dist/100);
      camera.far = dist*100;
      camera.updateProjectionMatrix();
      controls.target.copy(center);
      controls.update();
    }

    function setMaterialRecursive(obj, mat){
      obj.traverse((c)=>{
        if (c.isMesh){
          c.material = mat;
          c.material.needsUpdate = true;
        }
      });
    }

    let currentMode = "PBR";
    function applyMaterial(mode){
      currentMode = mode;
      const allowEnv = (mode === "PBR");
      scene.environment = allowEnv ? envMap : null;
      const useLights = (mode === "PBR");
      key.visible = fill.visible = rim.visible = useLights;
      const mat = materials[mode] || materials.PBR;
      setMaterialRecursive(modelRoot, mat);
    }

    // ---------- Panel lighting sync ----------
    const bioPanel = document.querySelector('.bio-panel');
    function updatePanelForExposure(exp){
      if (!bioPanel) return;
      const k = Math.min(Math.max(exp, 0.6), 1.8);
      const bgAlpha = 0.86 + (k-1.0)*0.06;
      const shadowAlpha = 0.18 + (k-1.0)*0.05;
      bioPanel.style.background = `rgba(255,255,255,${bgAlpha.toFixed(2)})`;
      bioPanel.style.boxShadow =
        `0 26px 60px rgba(0,0,0,${shadowAlpha.toFixed(2)}), 0 0 0 1px rgba(255,255,255,0.6)`;
    }

    // ---------- GUI ----------
    const gui = new GUI({title:"Settings"});
    // Move GUI into the stage so it overlays the viewer only
    container.appendChild(gui.domElement);
    gui.domElement.classList.add("viewer-controls");

    const params = {
      Mode: currentMode,
      AutoRotate: true,
      ToneMapping: "ACES",
      Exposure: 1.25,
      Roughness: materials.PBR.roughness
    };

    gui.add(params, "Mode", ["PBR","Surface Normals","UV Checker","Topology"]).onChange(applyMaterial);
    gui.add(params, "Auto Rotate");
    gui.add(params, "ToneMapping", ["ACES","Reinhard","Linear","None"]).onChange(v=>{
      renderer.toneMapping = ({
        "ACES": THREE.ACESFilmicToneMapping,
        "Reinhard": THREE.ReinhardToneMapping,
        "Linear": THREE.LinearToneMapping,
        "None": THREE.NoToneMapping
      })[v];
    });
    gui.add(params, "Exposure", 0.2, 2.5, 0.01).onChange(v=>{
      renderer.toneMappingExposure = v;
      updatePanelForExposure(v);
    });
    gui.add(params, "Roughness", 0.05, 1.0, 0.01).onChange(v=>{
      materials.PBR.roughness = v;
    });

    gui.close();

    // Initial panel sync
    updatePanelForExposure(params.Exposure);

    // ---------- Animate ----------
    const clock = new THREE.Clock();
    const spinSpeed = 0.4;
    function tick(){
      const dt = clock.getDelta();
      controls.update();
      if (params.AutoRotate && modelRoot) modelRoot.rotation.y += spinSpeed * dt;
      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }
    tick();

    // Resize
    window.addEventListener("resize", resizeRenderer);
    window.addEventListener("orientationchange", ()=>{
      setTimeout(resizeRenderer, 150);
    });

    // Go
    loadModel();
  </script>

  <!-- Tilt for bio panel + project carousel logic -->
  <script>
    const isMobileViewport = ()=> window.innerWidth <= 768;

    // Bio panel subtle tilt (desktop only)
    const bioPanelEl = document.querySelector('.bio-panel');
    if (bioPanelEl){
      const baseRotY = 5;
      const maxDeltaY = 1.5;
      const maxDeltaX = 1.0;

      window.addEventListener('mousemove', (e)=>{
        if (isMobileViewport()){
          bioPanelEl.style.transform = 'none';
          return;
        }
        const x = (e.clientX / window.innerWidth) - 0.5;
        const y = (e.clientY / window.innerHeight) - 0.5;

        const rx = y * maxDeltaX;
        const ry = baseRotY + (x * maxDeltaY);

        bioPanelEl.style.transform =
          `translateZ(0) rotateX(${rx}deg) rotateY(${ry}deg)`;
      });

      window.addEventListener('resize', ()=>{
        if (isMobileViewport()){
          bioPanelEl.style.transform = 'none';
        }
      });
    }

    // Project carousel
    const projectPanel = document.querySelector('.project-panel');
    if (projectPanel){
      const photoEl = projectPanel.querySelector('.project-photo');
      const titleEl = projectPanel.querySelector('.project-title');
      const titleLinkEl = projectPanel.querySelector('.project-title-link');
      const textEl  = projectPanel.querySelector('.project-text');
      const bodyEl = projectPanel.querySelector('.project-body');
      const dotsEl  = projectPanel.querySelector('.project-dots');
      const ctaEl = projectPanel.querySelector('.project-cta');

      let currentIndex = 0;
      let autoTimer = null;
      let projects = [];

      function renderProject(index){
        const p = projects[index];
        if (!p) return;
        if (titleLinkEl){
          titleLinkEl.textContent = p.title;
          titleLinkEl.href = p.href || "#";
        } else if (titleEl){
          titleEl.textContent = p.title;
        }
        if (ctaEl){
          ctaEl.href = p.href || "#";
        }
        textEl.textContent  = p.summary || "";
        if (bodyEl){
          bodyEl.innerHTML = "";
          const items = Array.isArray(p.body) ? p.body.slice(0, 2) : [];
          items.forEach((line)=>{
            const li = document.createElement('li');
            li.textContent = line;
            bodyEl.appendChild(li);
          });
        }
        photoEl.style.backgroundImage = p.image ? `url("${p.image}")` : "";

        // dots
        Array.from(dotsEl.children).forEach((dot, i)=>{
          dot.classList.toggle('active', i === index);
        });
      }

      function nextProject(){
        if (!projects.length) return;
        currentIndex = (currentIndex + 1) % projects.length;
        renderProject(currentIndex);
      }

      function resetTimer(){
        if (autoTimer) clearInterval(autoTimer);
        if (!projects.length) return;
        autoTimer = setInterval(nextProject, 7000); // 7s per project
      }

      async function loadProjects(){
        try{
          const res = await fetch("data/projects.json");
          const data = await res.json();
          projects = (data.projects || []).slice(0, 3).map(p => ({
            title: p.title,
            summary: p.summary,
            image: p.hero || p.thumb || "",
            href: p.slug ? `project.html?slug=${encodeURIComponent(p.slug)}` : "#",
            body: p.body
          }));
        } catch (e){
          projects = [];
        }

        dotsEl.innerHTML = "";
        projects.forEach((p, i)=>{
          const dot = document.createElement('button');
          dot.type = "button";
          dot.className = 'project-dot' + (i === 0 ? ' active' : '');
          dot.addEventListener('click', ()=>{
            currentIndex = i;
            renderProject(currentIndex);
            resetTimer();
          });
          dotsEl.appendChild(dot);
        });

        currentIndex = 0;
        renderProject(currentIndex);
        resetTimer();
      }

      loadProjects();

      // Optional: slight hover tilt on the project panel
      const baseRotYProj = -5;
      const maxDeltaYProj = 1.5;
      const maxDeltaXProj = 1.0;

      window.addEventListener('mousemove', (e)=>{
        if (isMobileViewport()){
          projectPanel.style.transform = 'none';
          return;
        }
        const x = (e.clientX / window.innerWidth) - 0.5;
        const y = (e.clientY / window.innerHeight) - 0.5;

        const rx = y * maxDeltaXProj;
        const ry = baseRotYProj + (x * maxDeltaYProj);

        projectPanel.style.transform =
          `translateZ(0) rotateX(${rx}deg) rotateY(${ry}deg)`;
      });

      window.addEventListener('resize', ()=>{
        if (isMobileViewport()){
          projectPanel.style.transform = 'none';
        }
      });
    }
  </script>
  <script src="js/include.js"></script>

</body>
</html>
