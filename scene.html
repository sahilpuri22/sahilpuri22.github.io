<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sahil Puri | Interactive Viewer</title>
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.161.0/build/three.module.js"
  }
}
</script>
<style>
  :root{
    --porcelain:   #f7f7f2;
    --beige:       #e4e6c3;
    --palm-leaf:   #899878;
    --carbon-black:#222725;
    --onyx:        #121113;
  }
  html,body{
    height:100%;
    margin:0;
    background:#ffffff;
    color:#000000;
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    perspective:1000px; /* helps 3D tilt feel better */
  }

  .nav{
    position:fixed;
    top:0;left:0;right:0;
    z-index:10;
    background:rgba(255,255,255,0.9);
    backdrop-filter:blur(10px);
    border-bottom:1px solid #e0e0e0;
  }
  .nav-inner{
    max-width:1100px;
    margin:0 auto;
    padding:12px 16px;
    display:flex;
    gap:16px;
    align-items:center;
  }
  .brand{
    font-weight:700;
    color:var(--carbon-black);
    text-decoration:none;
  }
  .tabs{
    margin-left:auto;
    display:flex;
    gap:10px;
  }
  .tab{
    color:#333333;
    text-decoration:none;
    padding:6px 10px;
    border-radius:8px;
    border:1px solid transparent;
  }
  .tab:hover{
    background:var(--porcelain);
    border-color:var(--beige);
  }

  /* Left panel + viewer layout */
  .bio-panel{
    position:fixed;
    /* float within viewport, not touching edges */
    top:80px;                     /* a bit below the nav */
    left:56px;                    /* away from the left edge */
    bottom:80px;

    /* larger, dominant on left third */
    width:min(520px, 42vw);       /* much bigger */
    max-height:calc(100vh - 80px - 40px);

    background:rgba(255,255,255,0.94);
    backdrop-filter:blur(16px);

    border-radius:22px;
    border:1px solid rgba(137,152,120,0.4);
    box-shadow:
      0 26px 60px rgba(0,0,0,0.24),
      0 0 0 1px rgba(255,255,255,0.6);

    z-index:3;
    display:flex;
    flex-direction:column;
    overflow:hidden;

    transform-origin:left center;
    /* left edge slightly closer, right edge further */
    transform:translateZ(0) rotateY(5deg);
    transition:
      transform 0.15s ease-out,
      box-shadow 0.15s ease-out,
      background 0.15s ease-out;
  }



  .bio-photo{
    padding:18px 0 10px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-bottom:1px solid rgba(137,152,120,0.35);
  }
  .bio-photo-inner{
    width:140px;
    height:140px;
    border-radius:50%;
    background:
      radial-gradient(circle at 30% 20%, rgba(255,255,255,0.9), rgba(255,255,255,0.2)),
      linear-gradient(135deg, rgba(137,152,120,0.8), rgba(228,230,195,0.7));
    box-shadow:0 10px 25px rgba(0,0,0,0.18);
    position:relative;
    overflow:hidden;
  }
  .bio-photo-inner::after{
    content:"";
    position:absolute;
    inset:0;
    background:radial-gradient(circle at 30% 20%, rgba(255,255,255,0.5), transparent 55%);
    mix-blend-mode:screen;
    pointer-events:none;
  }
  /* Optional: if you later add an img tag, it will sit inside this circle */
  .bio-photo-inner img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .bio-content{
    padding:16px 18px 18px;
    overflow-y:auto;
  }
  .bio-content h2{
    margin:0 0 4px;
    font-size:18px;
    font-weight:700;
    color:var(--carbon-black);
  }
  .bio-content h3{
    margin:0 0 14px;
    font-size:13px;
    font-weight:600;
    letter-spacing:0.08em;
    text-transform:uppercase;
    color:var(--palm-leaf);
  }
  .bio-content p{
    margin:0 0 14px;
    font-size:14px;
    line-height:1.6;
    color:#333333;
  }

  /* 3D stage shifted to the right of the panel */
  #stage{
    position:absolute;
    top:56px;            /* below navbar */
    left:0;
    right:0;
    bottom:0;        /* space for bottom controls */
    z-index:1;
  }



  .hint{
    position:fixed;
    left:24px;
    bottom:12px;
    color:#555555;
    font-size:12px;
    pointer-events:none;
    z-index:2;
  }
  .badge{
    position:fixed;
    right:12px;
    bottom:12px;
    background:rgba(255,255,255,0.9);
    border:1px solid #e0e0e0;
    color:#333333;
    padding:6px 10px;
    border-radius:8px;
    font-size:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    z-index:2;
  }

  /* Root GUI container */
  .viewer-controls{
    position:fixed;
    left:50%;
    bottom:16px;
    transform:translateX(-50%);
    z-index:3;

    /* Layout & size */
    min-width:420px;
    max-width:640px;

    /* New look */
    background:rgba(247,247,242,0.96);            /* porcelain */
    border-radius:18px;
    border:1px solid var(--beige);
    box-shadow:0 14px 36px rgba(0,0,0,0.16);

    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    color:var(--carbon-black);

    padding:6px 10px;
    display:flex;
    flex-direction:column;
  }

  /* Kill the default lil-gui dark chrome */
  .viewer-controls.lil-gui{
    background:transparent;
    border:none;
  }

  /* Header/title row */
  .viewer-controls .title{
    margin:0 0 4px;
    padding:0 4px;
    font-size:11px;
    font-weight:600;
    letter-spacing:0.14em;
    text-transform:uppercase;
    color:var(--carbon-black);
    opacity:0.7;
  }

  /* Controllers row container */
  .viewer-controls .children{
    display:flex;
    flex-wrap:wrap;
    gap:6px 10px;
  }

  /* Each controller row */
  .viewer-controls .controller{
    background:transparent !important;
    border:none !important;
    padding:4px 0;
    display:flex;
    align-items:center;
    gap:6px;
    font-size:12px;
  }

  /* Label on the left */
  .viewer-controls .controller .name{
    color:#555;
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:0.08em;
  }

  /* Display / input area */
  .viewer-controls .controller .display{
    flex:1;
  }

  /* Inputs, sliders, selects etc. */
  .viewer-controls input,
  .viewer-controls select{
    width:100%;
    border-radius:999px;
    border:1px solid rgba(137,152,120,0.4);
    background:#ffffff;
    color:var(--carbon-black);
    padding:3px 8px;
    font-size:12px;
    outline:none;
    box-shadow:none;
  }

  .viewer-controls input[type="range"]{
    padding:0;
    height:4px;
    border-radius:999px;
    border:none;
    background:rgba(137,152,120,0.25);
  }

  /* Buttons (like ResetCamera) */
  .viewer-controls button{
    border-radius:999px;
    border:1px solid rgba(137,152,120,0.6);
    background:#ffffff;
    color:var(--carbon-black);
    padding:4px 10px;
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:0.08em;
    cursor:pointer;
  }
  .viewer-controls button:hover{
    background:var(--beige);
  }

  /* Hide resize handle & folder toggles for a cleaner look */
  .viewer-controls .children .children{
    border:none;
  }
  .viewer-controls .close-button,
  .viewer-controls .reset{
    display:none;
  }

</style>

</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <a class="brand" href="index.html">Sahil Puri</a>
      <div class="tabs">
        <a class="tab" href="index.html">Home</a>
        <a class="tab" href="projects.html">Projects</a>
        <a class="tab" href="about.html">About</a>
        <a class="tab" href="contact.html">Contact</a>
      </div>
    </div>
  </nav>

  <div class="bio-panel">
    <div class="bio-photo">
      <div class="bio-photo-inner">
        <!-- Optional: put <img src="media/portrait.jpg" alt="Sahil"> here later -->
      </div>
    </div>
    <div class="bio-content">
      <h2>Sahil Puri</h2>
      <h3>Graphics &amp; Gameplay Engineer</h3>

      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua.
      </p>
      <p>
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi
        ut aliquip ex ea commodo consequat. Duis aute irure dolor in
        reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
      </p>
      <p>
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui
        officia deserunt mollit anim id est laborum.
      </p>
    </div>
  </div>

  <div id="stage"></div>
  <div class="hint">Scroll = zoom · Right-drag = pan · Left-drag = orbit</div>
  <div class="badge">Viewer: PBR / Wireframe / Normals / UV / Matcap / Depth</div>

  <!-- Three.js & helpers (CDN) -->
  <script type="module">
    import * as THREE from "three";
    import {OrbitControls} from "https://unpkg.com/three@0.161.0/examples/jsm/controls/OrbitControls.js";
    import {OBJLoader} from "https://unpkg.com/three@0.161.0/examples/jsm/loaders/OBJLoader.js";
    import {MTLLoader} from "https://unpkg.com/three@0.161.0/examples/jsm/loaders/MTLLoader.js";
    import {RGBELoader} from "https://unpkg.com/three@0.161.0/examples/jsm/loaders/RGBELoader.js";
    import {GUI} from "https://unpkg.com/lil-gui@0.19/dist/lil-gui.esm.js";

    // ---------- Basic scene ----------
    const container = document.getElementById("stage");
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.25;
    container.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color("#f7f7f2");

    const camera = new THREE.PerspectiveCamera(45, container.clientWidth/container.clientHeight, 0.05, 200);
    camera.position.set(2.5, 1.6, 3.0);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.06;
    controls.enablePan = false;
    controls.enableZoom = false;

    // ---------- Lights ----------
    const key = new THREE.DirectionalLight(0xffffff, 3.0);
    key.position.set(5, 6, 4);

    const fill = new THREE.HemisphereLight(0xffffff, 0x666666, 1.2);

    const rim = new THREE.DirectionalLight(0xffffff, 1.5);
    rim.position.set(-4, 3, -6);

    scene.add(key, fill, rim);

    // ---------- Environment (optional HDR) ----------
    let envMap = null;
    try {
      new RGBELoader()
        .setPath("assets/")
        .load("studio.hdr", (hdr)=>{
          hdr.mapping = THREE.EquirectangularReflectionMapping;
          envMap = hdr;
          scene.environment = envMap;
          renderer.render(scene, camera);
        });
    } catch(e){ /* no HDR, fine */ }

    // ---------- Materials / Modes ----------
    const texLoader = new THREE.TextureLoader().setCrossOrigin('anonymous');
    function makeChecker(size=512, squares=8){
      const c = document.createElement('canvas');
      c.width = c.height = size;
      const g = c.getContext('2d');
      const s = size/squares;
      for(let y=0;y<squares;y++){
        for(let x=0;x<squares;x++){
          g.fillStyle = (x+y)%2 ? "#9a8c98" : "#f2e9e4";
          g.fillRect(x*s,y*s,s,s);
        }
      }
      const t = new THREE.CanvasTexture(c);
      t.colorSpace = THREE.SRGBColorSpace;
      t.wrapS = t.wrapT = THREE.RepeatWrapping;
      t.repeat.set(1,1);
      return t;
    }
    const uvChecker = makeChecker();

    // Custom shaders for view/world normals & depth
    const normalVisMat = new THREE.ShaderMaterial({
      vertexShader: /* glsl */`
        varying vec3 vNormalVS;
        varying vec3 vNormalWS;
        void main(){
          vNormalWS = normalize(normalMatrix * normal);
          vec4 mv = modelViewMatrix * vec4(position,1.0);
          vNormalVS = normalize(mat3(modelViewMatrix) * normal);
          gl_Position = projectionMatrix * mv;
        }`,
      fragmentShader: /* glsl */`
        varying vec3 vNormalVS;
        varying vec3 vNormalWS;
        uniform bool viewSpace;
        void main(){
          vec3 n = normalize(viewSpace ? vNormalVS : vNormalWS);
          n = n * 0.5 + 0.5;
          gl_FragColor = vec4(n,1.0);
        }`,
      uniforms: { viewSpace: {value: true} }
    });

    const depthVisMat = new THREE.ShaderMaterial({
      vertexShader: /* glsl */`
        varying float vDepth;
        void main(){
          vec4 mv = modelViewMatrix * vec4(position,1.0);
          vDepth = -mv.z;
          gl_Position = projectionMatrix * mv;
        }`,
      fragmentShader: /* glsl */`
        varying float vDepth;
        uniform float near;
        uniform float far;
        float linear01(float z){ return (z - near) / (far - near); }
        void main(){
          float d = clamp(linear01(vDepth), 0.0, 1.0);
          gl_FragColor = vec4(vec3(d), 1.0);
        }`,
      uniforms: { near:{value: camera.near}, far:{value: camera.far} }
    });

    const matcap = texLoader.load("https://raw.githubusercontent.com/nidorx/matcaps/master/256/6C6C6C_9C9C9C_DDDDDD_FFFFFF-256px.png");
    matcap.colorSpace = THREE.SRGBColorSpace;

    const materials = {
      PBR: new THREE.MeshStandardMaterial({color:"#899878", metalness:0.25, roughness:0.45, envMapIntensity:1.35}),
      Wireframe: new THREE.MeshBasicMaterial({color:"#f2e9e4", wireframe:true}),
      UV_Checker: new THREE.MeshBasicMaterial({map: uvChecker}),
      Matcap: new THREE.MeshMatcapMaterial({matcap}),
      Normals_View: normalVisMat,
      Normals_World: normalVisMat.clone(),
      Depth: depthVisMat
    };
    materials.Normals_View.uniforms.viewSpace.value = true;
    materials.Normals_World.uniforms.viewSpace.value = false;

    // ---------- Load model (fallback if missing) ----------
    let modelRoot = new THREE.Group();
    scene.add(modelRoot);

    async function loadModel() {
      const objLoader = new OBJLoader().setPath("assets/");
      try{
        try {
          const mtl = await new MTLLoader().setPath("assets/").loadAsync("model.mtl");
          mtl.preload();
          objLoader.setMaterials(mtl);
        } catch {/* no MTL */}

        const obj = await objLoader.loadAsync("model.obj");
        const box = new THREE.Box3().setFromObject(obj);
        const center = new THREE.Vector3(); box.getCenter(center);
        obj.position.sub(center);
        obj.updateMatrixWorld(true);
        modelRoot.add(obj);
        fitCameraToObject(modelRoot);
      } catch (e){
        const geo = new THREE.TorusKnotGeometry(0.6, 0.22, 256, 32);
        const mesh = new THREE.Mesh(geo, materials.PBR);
        modelRoot.add(mesh);
        fitCameraToObject(modelRoot);
      }
      applyMaterial(currentMode);
    }

    function fitCameraToObject(obj){
      const box = new THREE.Box3().setFromObject(obj);
      const size = new THREE.Vector3(); box.getSize(size);
      const center = new THREE.Vector3(); box.getCenter(center);
      const maxDim = Math.max(size.x, size.y, size.z);
      const dist = maxDim / (2 * Math.tan(THREE.MathUtils.degToRad(camera.fov/2)));
      camera.position.copy(center).add(new THREE.Vector3(dist*1.6, dist*1.0, dist*1.6));
      camera.near = Math.max(0.01, dist/100);
      camera.far = dist*100;
      camera.updateProjectionMatrix();
      depthVisMat.uniforms.near.value = camera.near;
      depthVisMat.uniforms.far.value = camera.far;
      controls.target.copy(center);
      controls.update();
    }

    function setMaterialRecursive(obj, mat){
      obj.traverse((c)=>{
        if (c.isMesh){
          c.material = mat;
          c.material.needsUpdate = true;
        }
      });
    }

    let currentMode = "PBR";
    function applyMaterial(mode){
      currentMode = mode;
      const useEnv = (mode === "PBR" || mode === "Matcap");
      scene.environment = useEnv ? envMap : null;
      key.visible = (mode === "PBR" || mode === "UV_Checker" || mode.startsWith("Normals") || mode==="Depth");
      fill.visible = key.visible;
      if (mode === "Matcap") { key.visible = fill.visible = false; }
      const mat = materials[mode];
      setMaterialRecursive(modelRoot, mat);
    }

    // ---------- Panel lighting sync ----------
    const bioPanel = document.querySelector('.bio-panel');
    function updatePanelForExposure(exp){
      if (!bioPanel) return;
      const k = Math.min(Math.max(exp, 0.6), 1.8);
      const bgAlpha = 0.86 + (k-1.0)*0.06;
      const shadowAlpha = 0.18 + (k-1.0)*0.05;
      bioPanel.style.background = `rgba(255,255,255,${bgAlpha.toFixed(2)})`;
      bioPanel.style.boxShadow =
        `8px 0 30px rgba(0,0,0,${shadowAlpha.toFixed(2)}), inset -1px 0 0 rgba(255,255,255,0.6)`;
    }

    // ---------- GUI ----------
    const gui = new GUI({title:"Viewer"});
    const params = {
      Mode: currentMode,
      ViewSpaceNormals: true,
      ToneMapping: "ACES",
      Exposure: 1.25,
      ResetCamera(){ fitCameraToObject(modelRoot); }
    };

    gui.add(params, "Mode", Object.keys(materials)).onChange(applyMaterial);
    gui.add(params, "ViewSpaceNormals").onChange(v=>{
      materials.Normals_View.uniforms.viewSpace.value = true;
      materials.Normals_World.uniforms.viewSpace.value = false;
      if (currentMode.startsWith("Normals")){
        applyMaterial(v ? "Normals_View" : "Normals_World");
      }
    });
    gui.add(params, "ToneMapping", ["ACES","Reinhard","Linear","None"]).onChange(v=>{
      renderer.toneMapping = ({
        "ACES": THREE.ACESFilmicToneMapping,
        "Reinhard": THREE.ReinhardToneMapping,
        "Linear": THREE.LinearToneMapping,
        "None": THREE.NoToneMapping
      })[v];
    });
    gui.add(params, "Exposure", 0.2, 2.5, 0.01).onChange(v=>{
      renderer.toneMappingExposure = v;
      updatePanelForExposure(v);  // sync panel lighting
    });
    gui.add(params, "ResetCamera");
    gui.domElement.classList.add("viewer-controls");

    // Initial panel sync
    updatePanelForExposure(params.Exposure);

    // ---------- Animate ----------
    const clock = new THREE.Clock();
    const spinSpeed = 0.4;
    function tick(){
      const dt = clock.getDelta();
      controls.update();
      if (modelRoot) modelRoot.rotation.y += spinSpeed * dt;
      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }
    tick();

    // Resize
    window.addEventListener("resize", ()=>{
      renderer.setSize(container.clientWidth, container.clientHeight);
      camera.aspect = container.clientWidth/container.clientHeight;
      camera.updateProjectionMatrix();
    });

    // Go
    loadModel();
  </script>
  <script>
  const bioPanelEl = document.querySelector('.bio-panel');
  if (bioPanelEl){
    const baseRotY = 5;        // left edge closer, right further
    const maxDeltaY = 1.5;     // small side-to-side variation
    const maxDeltaX = 1.0;     // small up/down tilt

    window.addEventListener('mousemove', (e)=>{
      const x = (e.clientX / window.innerWidth) - 0.5; // -0.5..0.5
      const y = (e.clientY / window.innerHeight) - 0.5;

      const rx = y * maxDeltaX;           // very subtle X tilt
      const ry = baseRotY + (x * maxDeltaY); // vary around +5deg

      bioPanelEl.style.transform =
        `translateZ(0) rotateX(${rx}deg) rotateY(${ry}deg)`;
      });
    }
  </script>


</body>
</html>
